## Mysql-锁与事务学习

* #### 一些知识点

  * ##### ACID

  * ##### MVVC

  * ##### 数据库事务等级

  * #####   Mysql中不同事务阶段所出现的数据问题

* #### Innodb数据引擎

  * ##### 共享锁（S）

  * ##### 排他锁（X）

  * ##### 意向共享锁（IS）

  * ##### 意向排他锁（IX）

* #### Mysiam数据引擎

  * ##### 读锁

  * ##### 写锁



> #### 基础知识点

> #### ACID

##### ACID解读如下：

##### 事务是由一组SQL语句组成的逻辑处理单元，事务具有以下4个属性，通常称为事务的ACID属性。

* ##### A|原子性（Atomicity）：事务是一个原子操作单元，其对数据的修改，要么全都执行，要么全部都不执行。

* ##### C|一致性（Consistent）：在事务开始和完成时，数据都必须保持一致性的状态。这意味着所有相关的数据规则都必须应用于事务的修改，以保持数据的完整性；事务结束时，所有内部数据结构（如B树索引或双向链表）也都必须是正确的。

* ##### I|隔离性（Isolation）：数据库提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行。这意味着事务处理过程中的中间状态对外部是不可见的，反之亦然。

* ##### D|持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能保持。



> #### mvvc

##### 在数据库中，实现事务的隔离可以分为下述两种：

* ##### 使用锁机制，对所需要操纵的数据进行加锁操作

* ##### 不使用锁机制，通过一定机制生成一个数据请求时间点的一致性数据快照，并用这个快照来提供一定级别（语句级|事务级）的一致性读取。从用户的角度来看，在不同时间下，一个数据库会出现不同的版本（多个快照），这种技术叫做数据多版本并发控制（MVCC|MCC），也常叫做多版本数据库。



> ##### Mysql中不同事务阶段所出现的数据问题

##### 在并行的数据操纵时代，并发事务的处理大大不仅提高了数据库资源的利用率，还提高了数据库的事务吞吐量。但并发的情况下，资源在不同的环境里，会出现不一样的情况，如下：

* ##### 更新丢失：当一个事务更新某行数据库的数据，另外一个事务也在更新第一个事务中的数据时，便会出现数据丢失的问题。

* ##### 脏读：一个事务正在对一条记录做修改，在这个事务完成并提交前，这条记录的数据就处于不一致的状态了；此时另外一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些脏数据，并做进一步的处理，就回产生未提交的数据历来关系，此种现象被称为脏读。

* ##### 不可重读：一个事务在读取某些数据后的某个时间，再次读取以前读过的数据，发现其读出的数据已经发生了改变或者某些记录已被删除，此种现象称为不可重读。

* ##### 幻读：一个事务按相同的查询条件宠幸读取以前检索过的数据，却发现其他事务插入了满足其查询条件的数据，这种现象称为幻读。

##### 事例都基于事务的情况下，且按照常理来说，事务与事务间是互相隔离，互不干扰的才是正确的。

##### 其次脏读与不可重读在于，脏读是修改在前，读取在后，不可重读是读先，改后。



> ##### 事务等级

##### 目前mysql中支持事务的引擎是Innodb，其数据库等级如下：

| 隔离等级                     |                                          |      | 不可重读 | 幻读 |
| ---------------------------- | ---------------------------------------- | ---- | -------- | ---- |
| 未提交读（Read uncommitted） | 最低级别，只能保证不读取物理上损坏的数据 | 是   | 是       | 是   |
| 已提交读（Read committed）   | 语句级别                                 | 否   | 是       | 是   |
| 可重复读（Repeatable Read）  | 事务级                                   | 否   | 否       | 是   |
| 可序列化（Serializable）     | 最高级别，事务级                         | 否   | 否       | 否   |

